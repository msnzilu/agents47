{% extends 'users/base.html' %}
{% block title %}{% if integration %}Edit {{ integration.name }}{% else %}Add Integration{% endif %} - {{ SITE_NAME }}{% endblock %}
{% block content %}
<div class="max-w-5xl mx-auto p-4">
  <!-- Header -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4">
    <h1 class="text-2xl font-semibold text-gray-800">
      {% if integration %}Edit {{ integration.name }}{% else %}Add New Integration{% endif %}
    </h1>
  </div>

  <!-- Form -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
    <form method="post" action="{% if integration %}{% url 'integrations:integration_update' agent_id=agent.id pk=integration.id %}{% else %}{% url 'integrations:integration_create' agent_id=agent.id %}{% endif %}">
      {% csrf_token %}
      <div class="space-y-4">
        <!-- Name -->
        <div>
          <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
          <input type="text" name="name" id="name" value="{{ integration.name|default:'' }}" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" maxlength="255">
        </div>

        <!-- Integration Type -->
        <div>
          <label for="integration_type" class="block text-sm font-medium text-gray-700">Integration Type</label>
          <select name="integration_type" id="integration_type" {% if integration %}disabled{% endif %} required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
            {% for value, label in integration_types %}
              <option value="{{ value }}" {% if integration.integration_type == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- Webhook URL (for webhook type) -->
        <div id="webhook_fields" class="{% if integration and integration.integration_type != 'webhook' %}hidden{% endif %}">
          <label for="webhook_url" class="block text-sm font-medium text-gray-700">Webhook URL (optional)</label>
          <input type="url" name="webhook_url" id="webhook_url" value="{{ integration.webhook_url|default:'' }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" maxlength="500">
        </div>

        <!-- Active Status (for edit only) -->
        {% if integration %}
          <div>
            <label class="block text-sm font-medium text-gray-700">
              <input type="checkbox" name="is_active" {% if integration.is_active %}checked{% endif %} class="mr-2">
              Active
            </label>
          </div>
        {% endif %}

        <!-- Submit -->
        <div class="flex justify-end space-x-2">
          <a href="{% if integration %}{% url 'integrations:integration_detail' agent_id=agent.id pk=integration.id %}{% else %}{% url 'integrations:integration_list' agent_id=agent.id %}{% endif %}" class="btn btn-secondary">Cancel</a>
          <button type="submit" class="btn btn-primary">{% if integration %}Update{% else %}Create{% endif %}</button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- JavaScript for dynamic form behavior -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const integrationType = document.getElementById('integration_type');
    const webhookFields = document.getElementById('webhook_fields');
    
    integrationType.addEventListener('change', () => {
      webhookFields.classList.toggle('hidden', integrationType.value !== 'webhook');
    });
  });
</script>
{% endblock %}